{"version":3,"sources":["../../src/middlewares/rate-limitter.middleware.ts"],"sourcesContent":["/**\n * Rate limiting middleware using express-rate-limit.\n * Provides default and email verification rate limiters with custom error handling.\n */\nimport {\n  rateLimit,\n  type RateLimitRequestHandler,\n} from \"express-rate-limit\"\nimport { RATE_DELAY, RATE_LIMIT } from \"@config/index\";\nimport { HttpExceptionTooManyRequests } from \"@/exceptions/HttpException\";\n\n/**\n * Limitter class provides rate limiting strategies for API endpoints.\n */\nclass Limitter {\n  /**\n   * Default rate limiter for general requests.\n   * - windowMs: Delay in ms (from config, in minutes)\n   * - max: Max requests per window (from config)\n   * - keyGenerator: Uses IP address\n   * - handler: Throws custom TooManyRequests exception\n   */\n  public default = (): RateLimitRequestHandler => {\n    const delay = Number(RATE_DELAY) * 60 * 1000; // 1 menit\n\n    return rateLimit({\n      windowMs: delay, \n      max: Number(RATE_LIMIT),\n      keyGenerator: (req) => req.ip, \n      handler: () => {\n        throw new HttpExceptionTooManyRequests(\n          [`Too many requests from this IP, please try again after ${RATE_DELAY} minutes`],\n        );\n      },\n    });\n  };\n\n  /**\n   * Rate limiter for email verification requests.\n   * - windowMs: 3 minutes\n   * - max: 5 requests per window\n   * - keyGenerator: Uses IP address\n   * - handler: Throws custom TooManyRequests exception\n   */\n  public emailVerification = (): RateLimitRequestHandler => {\n    const delay = 3 * 60 * 1000; // 3 menit\n\n    return rateLimit({\n      windowMs: delay, \n      max: 5,\n      keyGenerator: (req) => req.ip, \n      handler: () => {\n        throw new HttpExceptionTooManyRequests(\n          [\"Too many requests from this IP, please try again after 5 minutes\"],\n        );\n      },\n    });\n  };\n}\n\nexport default Limitter;"],"names":["Limitter","default","delay","Number","RATE_DELAY","rateLimit","windowMs","max","RATE_LIMIT","keyGenerator","req","ip","handler","HttpExceptionTooManyRequests","emailVerification"],"mappings":";;;;+BA4DA;;;eAAA;;;kCArDO;uBACgC;+BACM;;;;;;;;;;;;;;AAK7C,IAAA,AAAMA,WAAN,MAAMA;;QAQJ,uBAAOC,WAAU;YACf,MAAMC,QAAQC,OAAOC,iBAAU,IAAI,KAAK;YAExC,OAAOC,IAAAA,2BAAS,EAAC;gBACfC,UAAUJ;gBACVK,KAAKJ,OAAOK,iBAAU;gBACtBC,cAAc,CAACC,MAAQA,IAAIC,EAAE;gBAC7BC,SAAS;oBACP,MAAM,IAAIC,2CAA4B,CACpC;wBAAC,CAAC,uDAAuD,EAAET,iBAAU,CAAC,QAAQ,CAAC;qBAAC;gBAEpF;YACF;QACF;QASA,uBAAOU,qBAAoB;YACzB,MAAMZ,QAAQ,IAAI,KAAK;YAEvB,OAAOG,IAAAA,2BAAS,EAAC;gBACfC,UAAUJ;gBACVK,KAAK;gBACLE,cAAc,CAACC,MAAQA,IAAIC,EAAE;gBAC7BC,SAAS;oBACP,MAAM,IAAIC,2CAA4B,CACpC;wBAAC;qBAAmE;gBAExE;YACF;QACF;;AACF;MAEA,WAAeb"}