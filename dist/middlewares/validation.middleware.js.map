{"version":3,"sources":["../../src/middlewares/validation.middleware.ts"],"sourcesContent":["import { NextFunction, Request, Response } from \"express\";\nimport { plainToInstance } from \"class-transformer\";\nimport { validateOrReject, ValidationError } from \"class-validator\";\nimport { HttpException } from \"@exceptions/HttpException\";\n\n/**\n * @name ValidationMiddleware\n * @description Allows use of decorator and non-decorator based validation\n * @param type dto\n * @param skipMissingProperties When skipping missing properties\n * @param whitelist Even if your object is an instance of a validation class it can contain additional properties that are not defined\n * @param forbidNonWhitelisted If you would rather to have an error thrown when any non-whitelisted properties are present\n */\nexport const ValidationMiddleware = (type: any, skipMissingProperties = false, whitelist = true, forbidNonWhitelisted = true) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const dto = plainToInstance(type, req.body);\n    validateOrReject(dto, { skipMissingProperties, whitelist, forbidNonWhitelisted })\n      .then(() => {\n        req.body = dto;\n        next();\n      })\n      .catch((errors: ValidationError[]) => {\n        const messages = errors.map((error: ValidationError) => {\n          if(Object.values(error.constraints)[0].endsWith(\"be empty\")) {\n            return Object.values(error.constraints)[0]\n              .split(\"_\")\n              .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n              .join(\" \");\n          }\n\n          if(Object.values(error.constraints)[0].endsWith(\"should not exist\")) {\n            return \"Invalid Property\"\n          }\n\n          if(Object.values(error.constraints)[0].endsWith(\"be a UUID\")) {\n            return Object.values(error.constraints)[0]\n              .split(\"_\")\n              .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n              .join(\" \");\n          }\n\n          if(Object.values(error.constraints)[0].includes(\"characters\")) {\n            return Object.values(error.constraints)[0]\n              .split(\"_\")\n              .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n              .join(\" \");\n          }\n          \n          return Object.values(error.constraints)[0];\n        });\n        \n        next(new HttpException(false, 400, \"Fields is required\", messages));\n      });\n  };\n};"],"names":["ValidationMiddleware","type","skipMissingProperties","whitelist","forbidNonWhitelisted","req","res","next","dto","plainToInstance","body","validateOrReject","then","catch","errors","messages","map","error","Object","values","constraints","endsWith","split","word","charAt","toUpperCase","slice","join","includes","HttpException"],"mappings":";;;;+BAaaA;;;eAAAA;;;kCAZmB;gCACkB;+BACpB;AAUvB,MAAMA,uBAAuB,CAACC,MAAWC,wBAAwB,KAAK,EAAEC,YAAY,IAAI,EAAEC,uBAAuB,IAAI;IAC1H,OAAO,CAACC,KAAcC,KAAeC;QACnC,MAAMC,MAAMC,IAAAA,iCAAe,EAACR,MAAMI,IAAIK,IAAI;QAC1CC,IAAAA,gCAAgB,EAACH,KAAK;YAAEN;YAAuBC;YAAWC;QAAqB,GAC5EQ,IAAI,CAAC;YACJP,IAAIK,IAAI,GAAGF;YACXD;QACF,GACCM,KAAK,CAAC,CAACC;YACN,MAAMC,WAAWD,OAAOE,GAAG,CAAC,CAACC;gBAC3B,IAAGC,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CAACC,QAAQ,CAAC,aAAa;oBAC3D,OAAOH,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CACvCE,KAAK,CAAC,KACNN,GAAG,CAACO,CAAAA,OAAQA,KAAKC,MAAM,CAAC,GAAGC,WAAW,KAAKF,KAAKG,KAAK,CAAC,IACtDC,IAAI,CAAC;gBACV;gBAEA,IAAGT,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CAACC,QAAQ,CAAC,qBAAqB;oBACnE,OAAO;gBACT;gBAEA,IAAGH,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CAACC,QAAQ,CAAC,cAAc;oBAC5D,OAAOH,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CACvCE,KAAK,CAAC,KACNN,GAAG,CAACO,CAAAA,OAAQA,KAAKC,MAAM,CAAC,GAAGC,WAAW,KAAKF,KAAKG,KAAK,CAAC,IACtDC,IAAI,CAAC;gBACV;gBAEA,IAAGT,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CAACQ,QAAQ,CAAC,eAAe;oBAC7D,OAAOV,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE,CACvCE,KAAK,CAAC,KACNN,GAAG,CAACO,CAAAA,OAAQA,KAAKC,MAAM,CAAC,GAAGC,WAAW,KAAKF,KAAKG,KAAK,CAAC,IACtDC,IAAI,CAAC;gBACV;gBAEA,OAAOT,OAAOC,MAAM,CAACF,MAAMG,WAAW,CAAC,CAAC,EAAE;YAC5C;YAEAb,KAAK,IAAIsB,4BAAa,CAAC,OAAO,KAAK,sBAAsBd;QAC3D;IACJ;AACF"}