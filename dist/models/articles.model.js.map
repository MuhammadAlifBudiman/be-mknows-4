{"version":3,"sources":["../../src/models/articles.model.ts"],"sourcesContent":["import { Sequelize, DataTypes, Model, Optional } from \"sequelize\";\n\nimport { User } from \"@interfaces/user.interface\";\nimport { File } from \"@interfaces/file.interface\";\nimport { Article } from \"@interfaces/article.interface\";\nimport { ArticleCategory } from \"@interfaces/article.interface\";\n\nimport { UserModel } from \"@models/users.model\";\nimport { FileModel } from \"@models/files.model\";\nimport { CategoryModel } from '@models/categories.model';\nimport { ArticleCategoryModel } from '@models/articles_categories.model';\n\nexport type ArticleCreationAttributes = Optional<Article, \"pk\" | \"uuid\">;\n\nexport class ArticleModel extends Model<Article, ArticleCreationAttributes> implements Article {\n  public pk: number;\n  public uuid: string;\n  \n  public title: string;\n  public description: string;\n  public content: string;\n\n  public thumbnail_id: number;\n  public author_id: number;\n\n  // Assosication\n  public readonly thumbnail: File;\n  public readonly author: User;\n  public readonly categories: ArticleCategory[];\n  public views: number;\n  public likes: number;\n  public comments: number;\n  public bookmarks: number;\n\n  public readonly created_at!: Date;\n  public readonly updated_at!: Date;\n  public readonly deleted_at: Date;\n}\n\nexport default function (sequelize: Sequelize): typeof ArticleModel {\n  ArticleModel.init(\n    {\n      pk: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      uuid: {\n        type: DataTypes.UUID,\n        defaultValue: DataTypes.UUIDV4,\n      },\n      title: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      description: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      content: {\n        type: DataTypes.TEXT,\n        allowNull: false,\n      },\n      thumbnail_id: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n        // references: {\n        //   model: FileModel,\n        //   key: \"pk\",\n        // },\n        // onDelete: \"CASCADE\",\n        // onUpdate: \"CASCADE\",\n      },  \n      author_id: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n        // references: {\n        //   model: UserModel,\n        //   key: \"pk\",\n        // },\n        // onDelete: \"CASCADE\",\n        // onUpdate: \"CASCADE\",\n      },\n    },\n    {\n      tableName: \"articles\",\n      timestamps: true,\n      paranoid: true,\n      sequelize,\n      defaultScope: {\n        include: [\n          {\n            attributes: [\"uuid\"],\n            model: FileModel,\n            as: \"thumbnail\",\n          },\n          {\n            attributes: [\"uuid\", \"full_name\", \"display_picture\"],\n            model: UserModel,\n            as: \"author\",\n            include: [\n              {\n                attributes: [\"uuid\"],\n                model: FileModel,\n                as: \"avatar\"\n              }\n            ]\n          },\n          {\n            attributes: [\"category_id\"],\n            model: ArticleCategoryModel,\n            as: \"categories\",\n            include: [{\n              attributes: [\"uuid\", \"name\", \"description\"],\n              model: CategoryModel, \n              as: \"category\"\n            }]\n          }\n        ],\n      }\n    },\n  );\n\n  FileModel.hasOne(ArticleModel, {\n    foreignKey: \"thumbnail_id\",\n    as: \"thumbnail\"\n  });\n\n  ArticleModel.belongsTo(FileModel, {\n    foreignKey: \"thumbnail_id\",\n    as: \"thumbnail\"\n  });\n\n  UserModel.hasMany(ArticleModel, {\n    foreignKey: \"author_id\",\n    as: \"author\"\n  });\n\n  ArticleModel.belongsTo(UserModel, {\n    foreignKey: \"author_id\",\n    as: \"author\"\n  });\n\n  return ArticleModel;\n}"],"names":["ArticleModel","Model","pk","uuid","title","description","content","thumbnail_id","author_id","thumbnail","author","categories","views","likes","comments","bookmarks","created_at","updated_at","deleted_at","sequelize","init","type","DataTypes","INTEGER","primaryKey","autoIncrement","UUID","defaultValue","UUIDV4","STRING","allowNull","TEXT","tableName","timestamps","paranoid","defaultScope","include","attributes","model","FileModel","as","UserModel","ArticleCategoryModel","CategoryModel","hasOne","foreignKey","belongsTo","hasMany"],"mappings":";;;;;;;;;;;QAcaA;eAAAA;;QAyBb;eAAA;;;2BAvCsD;4BAO5B;4BACA;iCACI;0CACO;;;;;;;;;;;;;;AAI9B,IAAA,AAAMA,eAAN,MAAMA,qBAAqBC,gBAAK;;QAAhC,gBACL,uBAAOC,MAAP,KAAA,IACA,uBAAOC,QAAP,KAAA,IAEA,uBAAOC,SAAP,KAAA,IACA,uBAAOC,eAAP,KAAA,IACA,uBAAOC,WAAP,KAAA,IAEA,uBAAOC,gBAAP,KAAA,IACA,uBAAOC,aAAP,KAAA,IAGA,uBAAgBC,aAAhB,KAAA,IACA,uBAAgBC,UAAhB,KAAA,IACA,uBAAgBC,cAAhB,KAAA,IACA,uBAAOC,SAAP,KAAA,IACA,uBAAOC,SAAP,KAAA,IACA,uBAAOC,YAAP,KAAA,IACA,uBAAOC,aAAP,KAAA,IAEA,uBAAgBC,cAAhB,KAAA,IACA,uBAAgBC,cAAhB,KAAA,IACA,uBAAgBC,cAAhB,KAAA;;AACF;AAEe,SAAf,SAAyBC,SAAoB;IAC3CnB,aAAaoB,IAAI,CACf;QACElB,IAAI;YACFmB,MAAMC,oBAAS,CAACC,OAAO;YACvBC,YAAY;YACZC,eAAe;QACjB;QACAtB,MAAM;YACJkB,MAAMC,oBAAS,CAACI,IAAI;YACpBC,cAAcL,oBAAS,CAACM,MAAM;QAChC;QACAxB,OAAO;YACLiB,MAAMC,oBAAS,CAACO,MAAM;YACtBC,WAAW;QACb;QACAzB,aAAa;YACXgB,MAAMC,oBAAS,CAACO,MAAM;YACtBC,WAAW;QACb;QACAxB,SAAS;YACPe,MAAMC,oBAAS,CAACS,IAAI;YACpBD,WAAW;QACb;QACAvB,cAAc;YACZc,MAAMC,oBAAS,CAACC,OAAO;YACvBO,WAAW;QAOb;QACAtB,WAAW;YACTa,MAAMC,oBAAS,CAACC,OAAO;YACvBO,WAAW;QAOb;IACF,GACA;QACEE,WAAW;QACXC,YAAY;QACZC,UAAU;QACVf;QACAgB,cAAc;YACZC,SAAS;gBACP;oBACEC,YAAY;wBAAC;qBAAO;oBACpBC,OAAOC,qBAAS;oBAChBC,IAAI;gBACN;gBACA;oBACEH,YAAY;wBAAC;wBAAQ;wBAAa;qBAAkB;oBACpDC,OAAOG,qBAAS;oBAChBD,IAAI;oBACJJ,SAAS;wBACP;4BACEC,YAAY;gCAAC;6BAAO;4BACpBC,OAAOC,qBAAS;4BAChBC,IAAI;wBACN;qBACD;gBACH;gBACA;oBACEH,YAAY;wBAAC;qBAAc;oBAC3BC,OAAOI,8CAAoB;oBAC3BF,IAAI;oBACJJ,SAAS;wBAAC;4BACRC,YAAY;gCAAC;gCAAQ;gCAAQ;6BAAc;4BAC3CC,OAAOK,8BAAa;4BACpBH,IAAI;wBACN;qBAAE;gBACJ;aACD;QACH;IACF;IAGFD,qBAAS,CAACK,MAAM,CAAC5C,cAAc;QAC7B6C,YAAY;QACZL,IAAI;IACN;IAEAxC,aAAa8C,SAAS,CAACP,qBAAS,EAAE;QAChCM,YAAY;QACZL,IAAI;IACN;IAEAC,qBAAS,CAACM,OAAO,CAAC/C,cAAc;QAC9B6C,YAAY;QACZL,IAAI;IACN;IAEAxC,aAAa8C,SAAS,CAACL,qBAAS,EAAE;QAChCI,YAAY;QACZL,IAAI;IACN;IAEA,OAAOxC;AACT"}