{"version":3,"sources":["../../src/controllers/auth.controller.ts"],"sourcesContent":["import { NextFunction, Request, Response } from \"express\";\nimport { Container } from \"typedi\";\nimport asyncHandler from \"express-async-handler\";\n\nimport { AuthService } from \"@services/auth.service\";\n\nimport { User, UserResponse } from \"@interfaces/user.interface\";\nimport { RequestWithUser } from \"@interfaces/authentication/token.interface\";\nimport { UserAgent } from \"@interfaces/common/useragent.interface\";\n\nimport { CreateUserDto } from \"@dtos/users.dto\";\n\nimport { getUserAgent } from \"@utils/userAgent\";\nimport { apiResponse } from \"@utils/apiResponse\";\nimport { HttpException } from \"@exceptions/HttpException\";\n\nexport class AuthController {\n  private auth = Container.get(AuthService);\n\n  public signUp = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const userData: CreateUserDto = req.body;\n    const signUpUserData: UserResponse = await this.auth.signup(userData);\n\n    res.status(201).json(apiResponse(201, \"OK\", \"Register Success\", signUpUserData));\n  });\n\n  public logIn = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const userAgentPayload: UserAgent = getUserAgent(req);\n    const userData: CreateUserDto = req.body;\n    \n    const { cookie, accessToken } = await this.auth.login(userData, userAgentPayload);\n\n    res.setHeader(\"Set-Cookie\", [cookie]);\n    res.status(200).json(apiResponse(200, \"OK\", \"Login Success\", { access_token: accessToken }));\n  });\n\n  public logOut = asyncHandler(async (req: RequestWithUser, res: Response, next: NextFunction) => {\n    const userData: User = req.user;\n    const userSessionId: string = req.session_id;\n\n    await this.auth.logout(userData, userSessionId);\n\n    res.setHeader(\"Set-Cookie\", [\"Authorization=; Max-age=0\"]);\n    res.status(200).json(apiResponse(200, \"OK\", \"Logout Success\", {}));\n  });\n\n  public verifyEmail = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const { uuid, otp } = req.body;\n    if(!uuid || !otp) throw new HttpException(false, 400, \"UUID and OTP is required\");\n\n    const response = await this.auth.verifyEmail(uuid, otp);\n    res.status(200).json(apiResponse(200, \"OK\", \"Email has been verified\", {\n      email: response.email\n    }));\n  });\n\n  public assignRoleToUser = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const user_uuid = req.params.uuid;\n    const { role } = req.body; \n    if (!role) {\n      throw new HttpException(false, 400, \"Role is required\");\n    }\n    const result = await this.auth.assignRoleToUser(user_uuid, role);\n    res.status(200).json(apiResponse(200, \"OK\", `Role '${role}' has been assigned to user`, result));\n  });\n}"],"names":["AuthController","auth","Container","get","AuthService","signUp","asyncHandler","req","res","next","userData","body","signUpUserData","signup","status","json","apiResponse","logIn","userAgentPayload","getUserAgent","cookie","accessToken","login","setHeader","access_token","logOut","user","userSessionId","session_id","logout","verifyEmail","uuid","otp","HttpException","response","email","assignRoleToUser","user_uuid","params","role","result"],"mappings":";;;;+BAgBaA;;;eAAAA;;;wBAfa;4EACD;6BAEG;2BAQC;6BACD;+BACE;;;;;;;;;;;;;;;;;;;AAEvB,IAAA,AAAMA,iBAAN,MAAMA;;QACX,uBAAQC,QAAOC,iBAAS,CAACC,GAAG,CAACC,wBAAW;QAExC,uBAAOC,UAASC,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YAC/D,MAAMC,WAA0BH,IAAII,IAAI;YACxC,MAAMC,iBAA+B,MAAM,IAAI,CAACX,IAAI,CAACY,MAAM,CAACH;YAE5DF,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,oBAAoBJ;QAClE;QAEA,uBAAOK,SAAQX,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YAC9D,MAAMS,mBAA8BC,IAAAA,uBAAY,EAACZ;YACjD,MAAMG,WAA0BH,IAAII,IAAI;YAExC,MAAM,EAAES,MAAM,EAAEC,WAAW,EAAE,GAAG,MAAM,IAAI,CAACpB,IAAI,CAACqB,KAAK,CAACZ,UAAUQ;YAEhEV,IAAIe,SAAS,CAAC,cAAc;gBAACH;aAAO;YACpCZ,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,iBAAiB;gBAAEQ,cAAcH;YAAY;QAC3F;QAEA,uBAAOI,UAASnB,IAAAA,4BAAY,EAAC,OAAOC,KAAsBC,KAAeC;YACvE,MAAMC,WAAiBH,IAAImB,IAAI;YAC/B,MAAMC,gBAAwBpB,IAAIqB,UAAU;YAE5C,MAAM,IAAI,CAAC3B,IAAI,CAAC4B,MAAM,CAACnB,UAAUiB;YAEjCnB,IAAIe,SAAS,CAAC,cAAc;gBAAC;aAA4B;YACzDf,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,kBAAkB,CAAC;QACjE;QAEA,uBAAOc,eAAcxB,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YACpE,MAAM,EAAEsB,IAAI,EAAEC,GAAG,EAAE,GAAGzB,IAAII,IAAI;YAC9B,IAAG,CAACoB,QAAQ,CAACC,KAAK,MAAM,IAAIC,4BAAa,CAAC,OAAO,KAAK;YAEtD,MAAMC,WAAW,MAAM,IAAI,CAACjC,IAAI,CAAC6B,WAAW,CAACC,MAAMC;YACnDxB,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,2BAA2B;gBACrEmB,OAAOD,SAASC,KAAK;YACvB;QACF;QAEA,uBAAOC,oBAAmB9B,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YACzE,MAAM4B,YAAY9B,IAAI+B,MAAM,CAACP,IAAI;YACjC,MAAM,EAAEQ,IAAI,EAAE,GAAGhC,IAAII,IAAI;YACzB,IAAI,CAAC4B,MAAM;gBACT,MAAM,IAAIN,4BAAa,CAAC,OAAO,KAAK;YACtC;YACA,MAAMO,SAAS,MAAM,IAAI,CAACvC,IAAI,CAACmC,gBAAgB,CAACC,WAAWE;YAC3D/B,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,CAAC,MAAM,EAAEuB,KAAK,2BAA2B,CAAC,EAAEC;QAC1F;;AACF"}