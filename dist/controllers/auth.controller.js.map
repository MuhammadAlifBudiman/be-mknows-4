{"version":3,"sources":["../../src/controllers/auth.controller.ts"],"sourcesContent":["/**\n * AuthController handles authentication and user management operations.\n * Provides endpoints for user registration, login, logout, email verification, and role assignment.\n */\nimport { NextFunction, Request, Response } from \"express\"; // Express types for request handling\nimport { Container } from \"typedi\"; // Dependency injection container\nimport asyncHandler from \"express-async-handler\"; // Async error handler middleware\n\nimport { AuthService } from \"@services/auth.service\"; // Service for authentication logic\n\nimport { User, UserResponse } from \"@interfaces/user.interface\"; // User interfaces\nimport { RequestWithUser } from \"@interfaces/authentication/token.interface\"; // Authenticated request interface\nimport { UserAgent } from \"@interfaces/common/useragent.interface\"; // User agent interface\n\nimport { CreateUserDto } from \"@dtos/users.dto\"; // DTO for user creation\n\nimport { getUserAgent } from \"@utils/userAgent\"; // Utility to parse user agent\nimport { apiResponse } from \"@utils/apiResponse\"; // Standardized API response\nimport { HttpException } from \"@exceptions/HttpException\"; // Custom HTTP exception\n\n/**\n * Main controller class for authentication endpoints\n */\nexport class AuthController {\n  /**\n   * AuthService instance for authentication operations\n   */\n  private auth = Container.get(AuthService);\n\n  /**\n   * Register a new user\n   * @param req - Express request containing user registration data\n   * @param res - Express response\n   * @param next - Express next middleware\n   */\n  public signUp = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const userData: CreateUserDto = req.body;\n    const signUpUserData: UserResponse = await this.auth.signup(userData);\n\n    res.status(201).json(apiResponse(201, \"OK\", \"Register Success\", signUpUserData));\n  });\n\n  /**\n   * Log in a user and set authentication cookie\n   * @param req - Express request containing login data\n   * @param res - Express response\n   * @param next - Express next middleware\n   */\n  public logIn = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const userAgentPayload: UserAgent = getUserAgent(req);\n    const userData: CreateUserDto = req.body;\n    \n    const { cookie, accessToken } = await this.auth.login(userData, userAgentPayload);\n\n    res.setHeader(\"Set-Cookie\", [cookie]);\n    res.status(200).json(apiResponse(200, \"OK\", \"Login Success\", { access_token: accessToken }));\n  });\n\n  /**\n   * Log out the authenticated user and clear authentication cookie\n   * @param req - Express request with user and session info\n   * @param res - Express response\n   * @param next - Express next middleware\n   */\n  public logOut = asyncHandler(async (req: RequestWithUser, res: Response, next: NextFunction) => {\n    const userData: User = req.user;\n    const userSessionId: string = req.session_id;\n\n    await this.auth.logout(userData, userSessionId);\n\n    res.setHeader(\"Set-Cookie\", [\"Authorization=; Max-age=0\"]);\n    res.status(200).json(apiResponse(200, \"OK\", \"Logout Success\", {}));\n  });\n\n  /**\n   * Verify user's email using UUID and OTP\n   * @param req - Express request containing uuid and otp\n   * @param res - Express response\n   * @param next - Express next middleware\n   */\n  public verifyEmail = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const { uuid, otp } = req.body;\n    if(!uuid || !otp) throw new HttpException(false, 400, \"UUID and OTP is required\");\n\n    const response = await this.auth.verifyEmail(uuid, otp);\n    res.status(200).json(apiResponse(200, \"OK\", \"Email has been verified\", {\n      email: response.email\n    }));\n  });\n\n  /**\n   * Assign a role to a user by UUID\n   * @param req - Express request containing user UUID and role\n   * @param res - Express response\n   * @param next - Express next middleware\n   */\n  public assignRoleToUser = asyncHandler(async (req: Request, res: Response, next: NextFunction) => {\n    const user_uuid = req.params.uuid;\n    const { role } = req.body; \n    if (!role) {\n      throw new HttpException(false, 400, \"Role is required\");\n    }\n    const result = await this.auth.assignRoleToUser(user_uuid, role);\n    res.status(200).json(apiResponse(200, \"OK\", `Role '${role}' has been assigned to user`, result));\n  });\n}"],"names":["AuthController","auth","Container","get","AuthService","signUp","asyncHandler","req","res","next","userData","body","signUpUserData","signup","status","json","apiResponse","logIn","userAgentPayload","getUserAgent","cookie","accessToken","login","setHeader","access_token","logOut","user","userSessionId","session_id","logout","verifyEmail","uuid","otp","HttpException","response","email","assignRoleToUser","user_uuid","params","role","result"],"mappings":";;;;+BAuBaA;;;eAAAA;;;wBAlBa;4EACD;6BAEG;2BAQC;6BACD;+BACE;;;;;;;;;;;;;;;;;;;AAKvB,IAAA,AAAMA,iBAAN,MAAMA;;QAIX,uBAAQC,QAAOC,iBAAS,CAACC,GAAG,CAACC,wBAAW;QAQxC,uBAAOC,UAASC,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YAC/D,MAAMC,WAA0BH,IAAII,IAAI;YACxC,MAAMC,iBAA+B,MAAM,IAAI,CAACX,IAAI,CAACY,MAAM,CAACH;YAE5DF,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,oBAAoBJ;QAClE;QAQA,uBAAOK,SAAQX,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YAC9D,MAAMS,mBAA8BC,IAAAA,uBAAY,EAACZ;YACjD,MAAMG,WAA0BH,IAAII,IAAI;YAExC,MAAM,EAAES,MAAM,EAAEC,WAAW,EAAE,GAAG,MAAM,IAAI,CAACpB,IAAI,CAACqB,KAAK,CAACZ,UAAUQ;YAEhEV,IAAIe,SAAS,CAAC,cAAc;gBAACH;aAAO;YACpCZ,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,iBAAiB;gBAAEQ,cAAcH;YAAY;QAC3F;QAQA,uBAAOI,UAASnB,IAAAA,4BAAY,EAAC,OAAOC,KAAsBC,KAAeC;YACvE,MAAMC,WAAiBH,IAAImB,IAAI;YAC/B,MAAMC,gBAAwBpB,IAAIqB,UAAU;YAE5C,MAAM,IAAI,CAAC3B,IAAI,CAAC4B,MAAM,CAACnB,UAAUiB;YAEjCnB,IAAIe,SAAS,CAAC,cAAc;gBAAC;aAA4B;YACzDf,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,kBAAkB,CAAC;QACjE;QAQA,uBAAOc,eAAcxB,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YACpE,MAAM,EAAEsB,IAAI,EAAEC,GAAG,EAAE,GAAGzB,IAAII,IAAI;YAC9B,IAAG,CAACoB,QAAQ,CAACC,KAAK,MAAM,IAAIC,4BAAa,CAAC,OAAO,KAAK;YAEtD,MAAMC,WAAW,MAAM,IAAI,CAACjC,IAAI,CAAC6B,WAAW,CAACC,MAAMC;YACnDxB,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,2BAA2B;gBACrEmB,OAAOD,SAASC,KAAK;YACvB;QACF;QAQA,uBAAOC,oBAAmB9B,IAAAA,4BAAY,EAAC,OAAOC,KAAcC,KAAeC;YACzE,MAAM4B,YAAY9B,IAAI+B,MAAM,CAACP,IAAI;YACjC,MAAM,EAAEQ,IAAI,EAAE,GAAGhC,IAAII,IAAI;YACzB,IAAI,CAAC4B,MAAM;gBACT,MAAM,IAAIN,4BAAa,CAAC,OAAO,KAAK;YACtC;YACA,MAAMO,SAAS,MAAM,IAAI,CAACvC,IAAI,CAACmC,gBAAgB,CAACC,WAAWE;YAC3D/B,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAACC,IAAAA,wBAAW,EAAC,KAAK,MAAM,CAAC,MAAM,EAAEuB,KAAK,2BAA2B,CAAC,EAAEC;QAC1F;;AACF"}