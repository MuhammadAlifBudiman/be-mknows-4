{"version":3,"sources":["../../src/database/db-lazy.ts"],"sourcesContent":["import { Sequelize } from \"sequelize\";\nimport { NODE_ENV } from \"@config/index\";\nimport { logger } from \"@utils/logger\";\nimport config from \"@config/database\";\nimport OTPModel from \"@/models/otps.model\";\nimport RoleModel from \"@models/roles.model\";\nimport FileModel from \"@models/files.model\";\nimport UserModel from \"@models/users.model\";\nimport UserRoleModel from \"@models/users_roles.model\";\nimport UserSessionModel from \"@models/users_sessions.model\";\nimport CategoryModel from \"@models/categories.model\";\nimport ArticleModel from \"@models/articles.model\";\nimport ArticleCategoryModel from \"@models/articles_categories.model\";\nimport ArticleLikeModel from \"@models/articles_likes.model\";\nimport ArticleCommentModel from \"@/models/articles_comments.model\";\nimport CommentReplyModel from \"@/models/articles_replies.model\";\nimport ArticleCommentLikeModel from \"@/models/articles_comments_like.model\";\nimport CommentReplyLikeModel from \"@/models/articles_replies_like.model\";\nimport ArticleBookmarkModel from \"@/models/articles_bookmark.model\";\nimport ArticleViewModel from \"@/models/articles_views.model\";\n\nlet DB: any = null;\nlet initializing = false;\nlet initialized = false;\n\nexport async function getDB() {\n  if (initialized) return DB;\n  if (initializing) {\n    while (!initialized) {\n      await new Promise((resolve) => setTimeout(resolve, 50));\n    }\n    return DB;\n  }\n  initializing = true;\n\n  const dbConfig = config[NODE_ENV] || config[\"development\"];\n  const sequelize = new Sequelize(\n    dbConfig.database as string,\n    dbConfig.username as string,\n    dbConfig.password,\n    dbConfig\n  );\n  await sequelize.authenticate();\n  logger.info(`=> Database Connected on ${NODE_ENV}`);\n\n  DB = {\n    OTPs: OTPModel(sequelize),\n    Files: FileModel(sequelize),\n    Roles: RoleModel(sequelize),\n    Users: UserModel(sequelize),\n    UsersRoles: UserRoleModel(sequelize),\n    UsersSessions: UserSessionModel(sequelize),\n    Categories: CategoryModel(sequelize),\n    Articles: ArticleModel(sequelize),\n    ArticlesCategories: ArticleCategoryModel(sequelize),\n    ArticlesLikes: ArticleLikeModel(sequelize),\n    ArticlesComments: ArticleCommentModel(sequelize),\n    CommentsReplies: CommentReplyModel(sequelize),\n    ArticleCommentsLikes: ArticleCommentLikeModel(sequelize),\n    CommentsRepliesLikes: CommentReplyLikeModel(sequelize),\n    ArticlesBookmarks: ArticleBookmarkModel(sequelize),\n    ArticlesViews: ArticleViewModel(sequelize),\n    sequelize, // connection instance (RAW queries)\n    Sequelize, // library\n  };\n  initialized = true;\n  return DB;\n}\n"],"names":["getDB","DB","initializing","initialized","Promise","resolve","setTimeout","dbConfig","config","NODE_ENV","sequelize","Sequelize","database","username","password","authenticate","logger","info","OTPs","OTPModel","Files","FileModel","Roles","RoleModel","Users","UserModel","UsersRoles","UserRoleModel","UsersSessions","UserSessionModel","Categories","CategoryModel","Articles","ArticleModel","ArticlesCategories","ArticleCategoryModel","ArticlesLikes","ArticleLikeModel","ArticlesComments","ArticleCommentModel","CommentsReplies","CommentReplyModel","ArticleCommentsLikes","ArticleCommentLikeModel","CommentsRepliesLikes","CommentReplyLikeModel","ArticlesBookmarks","ArticleBookmarkModel","ArticlesViews","ArticleViewModel"],"mappings":";;;;+BAyBsBA;;;eAAAA;;;2BAzBI;uBACD;wBACF;iEACJ;kEACE;mEACC;mEACA;mEACA;yEACI;4EACG;wEACH;sEACD;iFACQ;4EACJ;+EACG;8EACF;oFACM;mFACF;+EACD;4EACJ;;;;;;AAE7B,IAAIC,KAAU;AACd,IAAIC,eAAe;AACnB,IAAIC,cAAc;AAEX,eAAeH;IACpB,IAAIG,aAAa,OAAOF;IACxB,IAAIC,cAAc;QAChB,MAAO,CAACC,YAAa;YACnB,MAAM,IAAIC,QAAQ,CAACC,UAAYC,WAAWD,SAAS;QACrD;QACA,OAAOJ;IACT;IACAC,eAAe;IAEf,MAAMK,WAAWC,iBAAM,CAACC,eAAQ,CAAC,IAAID,iBAAM,CAAC,cAAc;IAC1D,MAAME,YAAY,IAAIC,oBAAS,CAC7BJ,SAASK,QAAQ,EACjBL,SAASM,QAAQ,EACjBN,SAASO,QAAQ,EACjBP;IAEF,MAAMG,UAAUK,YAAY;IAC5BC,cAAM,CAACC,IAAI,CAAC,CAAC,yBAAyB,EAAER,eAAQ,EAAE;IAElDR,KAAK;QACHiB,MAAMC,IAAAA,kBAAQ,EAACT;QACfU,OAAOC,IAAAA,mBAAS,EAACX;QACjBY,OAAOC,IAAAA,mBAAS,EAACb;QACjBc,OAAOC,IAAAA,mBAAS,EAACf;QACjBgB,YAAYC,IAAAA,yBAAa,EAACjB;QAC1BkB,eAAeC,IAAAA,4BAAgB,EAACnB;QAChCoB,YAAYC,IAAAA,wBAAa,EAACrB;QAC1BsB,UAAUC,IAAAA,sBAAY,EAACvB;QACvBwB,oBAAoBC,IAAAA,iCAAoB,EAACzB;QACzC0B,eAAeC,IAAAA,4BAAgB,EAAC3B;QAChC4B,kBAAkBC,IAAAA,+BAAmB,EAAC7B;QACtC8B,iBAAiBC,IAAAA,8BAAiB,EAAC/B;QACnCgC,sBAAsBC,IAAAA,oCAAuB,EAACjC;QAC9CkC,sBAAsBC,IAAAA,mCAAqB,EAACnC;QAC5CoC,mBAAmBC,IAAAA,+BAAoB,EAACrC;QACxCsC,eAAeC,IAAAA,4BAAgB,EAACvC;QAChCA;QACAC,WAAAA,oBAAS;IACX;IACAR,cAAc;IACd,OAAOF;AACT"}