{"version":3,"sources":["../../src/services/files.service.ts"],"sourcesContent":["import { Service } from \"typedi\";\nimport { DB } from \"@database\";\n\nimport { File } from \"@interfaces/file.interface\";\nimport { HttpException } from \"@/exceptions/HttpException\";\n\n@Service()\nexport class FileService {\n  public async uploadSingleFile(user_id: number, file: Express.Multer.File): Promise<File> {\n    const fileUpload = await DB.Files.create({\n      user_id,\n      name: file.filename,\n      type: file.mimetype,\n      size: file.size\n    });\n\n    delete fileUpload.dataValues.pk;\n    delete fileUpload.dataValues.name;\n    delete fileUpload.dataValues.user_id;\n\n    return fileUpload;\n  };\n  \n  public async getFileWithUUID(file_uuid: string): Promise<File> {\n    const file = await DB.Files.findOne({\n      attributes: [\"name\"],\n      where: {\n        uuid: file_uuid\n      }\n    });\n\n    if(!file) throw new HttpException(false, 400, \"File is not found\");\n    return file;\n  };\n\n  public async getUserFiles(user_id: number): Promise<File[]> {\n    const files = await DB.Files.findAll({\n      attributes: { exclude: [\"pk\", \"user_id\", \"name\"] },\n      where: {\n        user_id\n      }\n    });\n\n    return files;\n  };\n};"],"names":["FileService","uploadSingleFile","user_id","file","fileUpload","DB","Files","create","name","filename","type","mimetype","size","dataValues","pk","getFileWithUUID","file_uuid","findOne","attributes","where","uuid","HttpException","getUserFiles","files","findAll","exclude"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPW;0BACL;+BAGW;;;;;;;AAGvB,IAAA,AAAMA,cAAN,MAAMA;IACX,MAAaC,iBAAiBC,OAAe,EAAEC,IAAyB,EAAiB;QACvF,MAAMC,aAAa,MAAMC,YAAE,CAACC,KAAK,CAACC,MAAM,CAAC;YACvCL;YACAM,MAAML,KAAKM,QAAQ;YACnBC,MAAMP,KAAKQ,QAAQ;YACnBC,MAAMT,KAAKS,IAAI;QACjB;QAEA,OAAOR,WAAWS,UAAU,CAACC,EAAE;QAC/B,OAAOV,WAAWS,UAAU,CAACL,IAAI;QACjC,OAAOJ,WAAWS,UAAU,CAACX,OAAO;QAEpC,OAAOE;IACT;IAEA,MAAaW,gBAAgBC,SAAiB,EAAiB;QAC7D,MAAMb,OAAO,MAAME,YAAE,CAACC,KAAK,CAACW,OAAO,CAAC;YAClCC,YAAY;gBAAC;aAAO;YACpBC,OAAO;gBACLC,MAAMJ;YACR;QACF;QAEA,IAAG,CAACb,MAAM,MAAM,IAAIkB,4BAAa,CAAC,OAAO,KAAK;QAC9C,OAAOlB;IACT;IAEA,MAAamB,aAAapB,OAAe,EAAmB;QAC1D,MAAMqB,QAAQ,MAAMlB,YAAE,CAACC,KAAK,CAACkB,OAAO,CAAC;YACnCN,YAAY;gBAAEO,SAAS;oBAAC;oBAAM;oBAAW;iBAAO;YAAC;YACjDN,OAAO;gBACLjB;YACF;QACF;QAEA,OAAOqB;IACT;AACF"}