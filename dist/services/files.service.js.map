{"version":3,"sources":["../../src/services/files.service.ts"],"sourcesContent":["import { Service } from \"typedi\";\nimport { DB } from \"@database\";\n\nimport { File } from \"@interfaces/file.interface\";\nimport { HttpException } from \"@/exceptions/HttpException\";\n\n@Service()\nexport class FileService {\n  public async uploadSingleFile(user_id: number, file: Express.Multer.File): Promise<File> {\n    // Save S3 URL if available\n    const fileUpload = await DB.Files.create({\n      user_id,\n      name: file.filename,\n      type: file.mimetype,\n      size: file.size,\n      url: (file as any).location || null, // S3 URL from uploadToS3\n    });\n\n    delete fileUpload.dataValues.pk;\n    delete fileUpload.dataValues.name;\n    delete fileUpload.dataValues.user_id;\n\n    return fileUpload;\n  };\n  \n  public async getFileWithUUID(file_uuid: string): Promise<File> {\n    const file = await DB.Files.findOne({\n      attributes: [\"name\", \"url\"],\n      where: {\n        uuid: file_uuid\n      }\n    });\n\n    if(!file) throw new HttpException(false, 400, \"File is not found\");\n    return file;\n  };\n\n  public async getUserFiles(user_id: number): Promise<File[]> {\n    const files = await DB.Files.findAll({\n      attributes: { exclude: [\"pk\", \"user_id\", \"name\"] },\n      where: {\n        user_id\n      }\n    });\n\n    return files;\n  };\n};"],"names":["FileService","uploadSingleFile","user_id","file","fileUpload","DB","Files","create","name","filename","type","mimetype","size","url","location","dataValues","pk","getFileWithUUID","file_uuid","findOne","attributes","where","uuid","HttpException","getUserFiles","files","findAll","exclude"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPW;0BACL;+BAGW;;;;;;;AAGvB,IAAA,AAAMA,cAAN,MAAMA;IACX,MAAaC,iBAAiBC,OAAe,EAAEC,IAAyB,EAAiB;QAEvF,MAAMC,aAAa,MAAMC,YAAE,CAACC,KAAK,CAACC,MAAM,CAAC;YACvCL;YACAM,MAAML,KAAKM,QAAQ;YACnBC,MAAMP,KAAKQ,QAAQ;YACnBC,MAAMT,KAAKS,IAAI;YACfC,KAAK,AAACV,KAAaW,QAAQ,IAAI;QACjC;QAEA,OAAOV,WAAWW,UAAU,CAACC,EAAE;QAC/B,OAAOZ,WAAWW,UAAU,CAACP,IAAI;QACjC,OAAOJ,WAAWW,UAAU,CAACb,OAAO;QAEpC,OAAOE;IACT;IAEA,MAAaa,gBAAgBC,SAAiB,EAAiB;QAC7D,MAAMf,OAAO,MAAME,YAAE,CAACC,KAAK,CAACa,OAAO,CAAC;YAClCC,YAAY;gBAAC;gBAAQ;aAAM;YAC3BC,OAAO;gBACLC,MAAMJ;YACR;QACF;QAEA,IAAG,CAACf,MAAM,MAAM,IAAIoB,4BAAa,CAAC,OAAO,KAAK;QAC9C,OAAOpB;IACT;IAEA,MAAaqB,aAAatB,OAAe,EAAmB;QAC1D,MAAMuB,QAAQ,MAAMpB,YAAE,CAACC,KAAK,CAACoB,OAAO,CAAC;YACnCN,YAAY;gBAAEO,SAAS;oBAAC;oBAAM;oBAAW;iBAAO;YAAC;YACjDN,OAAO;gBACLnB;YACF;QACF;QAEA,OAAOuB;IACT;AACF"}